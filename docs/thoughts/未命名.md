---
title: 未命名
date: 2024-04-29 19:32:23
description: 这是一篇新文章!
publish: true
tags:
  - 计算机世界观
---

# 序

JavaScript 原本只是个运行在浏览器里的脚本语言，直到 Node.js 把它带到了服务器端，才真正让 JS 拥有了构建大型项目的可能。  
但一个现代项目，往往会依赖数十上百个第三方工具和库，它们之间的依赖关系极为复杂，版本、结构、安装顺序稍有差错就可能导致项目崩溃。

**手动下载解压？维护一堆文件夹？——根本不现实。**

于是，为了让开发者专注于写代码而不是折腾依赖，一个“自动化模块管理工具”就诞生了：包管理器。

它能做的事包括：

- 统一管理项目依赖（记录版本、来源）
- 自动下载安装依赖，解决嵌套依赖问题
- 保证跨平台/多人协作时的依赖一致性
- 支持发布/共享自定义模块到社区生态

如果你今天创建一个前端项目，却没有包管理器的协助，那就像是赤手空拳盖高楼。

# npm-包管理的起点

随着 Node.js 的流行，npm（Node Package Manager）在 2010 年应运而生，并作为其官方包管理器被推出，它理所当然地成为了 Node.js 生态的核心基石。

它的三大核心功能包括：

- 安装和卸载依赖
- 统一管理项目依赖关系
- 从 npm Registry 获取社区包

几乎每一个现代 JavaScript 项目中你见到的包，无论是 `axios`、`vue`、还是 `eslint`，本质上都来自 npm 提供的这一生态系统。

npm 通过一个结构清晰的机制来完成依赖管理：

- **`package.json`**：声明当前项目依赖了什么、用什么脚本启动、作者是谁…
- **`package-lock.json`**：锁定具体依赖版本，保证协作一致性
- **`node_modules/`**：将安装下来的依赖全部放进去，供项目调用

每当你执行 `npm install`，npm 就会：

1. 查阅 `package.json`
2. 下载依赖包（及其依赖的依赖）
3. 写入 `node_modules` 和 `package-lock.json`

随着项目变得庞大、依赖树变得复杂，npm 在安装速度、依赖结构、锁文件一致性等方面暴露出了明显短板：安装慢、生成大量冗余依赖、在不同机器上容易出现“我的装得和你不一样”的情况。
尽管 npm 在之后不断改进，推出了缓存机制和 `npm ci` 这类优化命令，但还是无法从根本上解决这些痛点。正是在这种背景下，Yarn 和 pnpm 这样的替代品开始崭露头角。

# yarn-优化工具

2016 年，Facebook 内部工程师们终于受够了 npm 安装慢、版本不一致等问题，决定自研一个更可靠、更快的包管理器——Yarn 就此诞生。
它在发布初期就迅速引起了 JavaScript 社区的关注，并成为许多大型项目的默认工具。

Yarn 的设计初衷是：**“让依赖安装变得快速、确定、可重复。”**

为此它带来了几项关键优化：

- **离线缓存机制**：装过的包会被缓存下来，下一次就不需要联网下载，提升了速度；
- **更可靠的锁定文件（`yarn.lock`）**：确保不同人安装出来的依赖版本完全一致；
- **更扁平的依赖结构**：尽量把所有依赖都安装在项目根目录，避免深层嵌套导致的“地狱结构”。

在使用体验上，Yarn 提供了类似 npm 的命令结构：

| 功能     | npm 命令              | Yarn 命令           |
| -------- | --------------------- | ------------------- |
| 安装依赖 | `npm install`         | `yarn install`      |
| 添加依赖 | `npm install axios`   | `yarn add axios`    |
| 移除依赖 | `npm uninstall axios` | `yarn remove axios` |

虽然 Yarn 相比 npm 提供了不少优势，但也有一些不可忽视的遗留问题：

- **依赖仍是扁平结构**：所有包统一堆在根目录的 `node_modules/` 中，容易冲突、冗余。
- **磁盘占用高**：缓存机制虽加快了安装速度，但缓存 + 扁平结构导致重复存储，占用空间严重。
- **缓存不易清理**：即便清除缓存或锁文件，有时依然会遇到依赖错乱的问题。

总的来说，Yarn 曾是 JavaScript 包管理的“黄金标准”，但随着项目规模膨胀，尤其是 **monorepo（单仓多包）** 模式流行，依赖管理愈发复杂，Yarn 的架构已难以胜任更高效的场景。
正是在这个时候，pnpm 出场了。
