---
title: 未命名
date: 2025-05-18 19:17:14
published: false
tags:
categories: 
excerpt: "这是一篇新文章!"
thumbnail: "/img/文章封面/defaultcover.jpg"
---

# Vue 3 项目代码规范自动化配置笔记

## 一、前言：代码规范的意义

在团队开发中，保持统一的代码风格至关重要。它有助于：

1. 提高代码可读性
2. 减少无意义的格式修改引起的合并冲突
3. 降低团队成员理解代码的门槛
4. 提前发现潜在的代码问题

本笔记将详细说明如何在 Vue 3 项目中配置 ESLint、Prettier、VS Code 设置以及 Git 钩子，实现代码规范自动化。

## 二、项目初始化与依赖安装

### 1. 创建 Vue 3 项目

```bash
pnpm create vue@latest
```

在交互式提示中选择：

- ✅ 添加 ESLint
- ✅ 添加 Prettier

这一步骤会自动安装基础的 ESLint 和 Prettier 依赖。

### 2. 安装额外依赖

```bash
pnpm install
pnpm add -D eslint-plugin-prettier
```

`eslint-plugin-prettier` 是连接 ESLint 和 Prettier 的桥梁，它能让 ESLint 使用 Prettier 的规则进行格式化。

## 三、配置文件详解

### 1. ESLint 配置 (eslint.config.js)

```javascript
import { defineConfig, globalIgnores } from 'eslint/config'
import globals from 'globals'
import js from '@eslint/js'
import pluginVue from 'eslint-plugin-vue'
import pluginPrettier from 'eslint-plugin-prettier'
import skipFormatting from '@vue/eslint-config-prettier/skip-formatting'

export default defineConfig([
  {
    name: 'app/files-to-lint',
    files: ['**/*.{js,mjs,jsx,vue}'],
  },

  globalIgnores(['**/dist/**', '**/dist-ssr/**', '**/coverage/**']),

  {
    languageOptions: {
      globals: {
        ...globals.browser,
      },
    },
  },

  js.configs.recommended,
  ...pluginVue.configs['flat/essential'],
  skipFormatting,

  // 添加prettier插件配置
  {
    plugins: {
      prettier: pluginPrettier
    },
    rules: {
      'prettier/prettier': [
        'warn',
        {
          singleQuote: true,  // 使用单引号
          semi: false,        // 不使用分号
          printWidth: 80,     // 每行最大宽度
          trailingComma: 'none', // 对象/数组不加末尾逗号
          endOfLine: 'auto'   // 自动识别换行符（解决Windows/Mac差异）
        }
      ],
      'vue/multi-word-component-names': [
        'warn',
        {
          ignores: ['index']  // Vue组件强制多单词命名（除了index.vue）
        }
      ],
      'vue/no-setup-props-destructure': ['off'], // 关闭props解构校验
      'no-undef': 'error'    // 提示未定义变量错误
    }
  }
])
```

**关键点解析：**

- `plugins.prettier: pluginPrettier` - 正确注册 prettier 插件
- 自定义规则详细配置了代码风格，包括单引号、无分号等
- `globalIgnores` 排除不需要检查的文件夹
- Vue 特定规则的配置解决开发中常见的问题

### 2. Prettier 配置 (.prettierrc.json)

```json
{
  "$schema": "https://json.schemastore.org/prettierrc",
  "semi": false,
  "singleQuote": true,
  "printWidth": 80,
  "trailingComma": "none",
  "endOfLine": "auto"
}
```

**注意：**

- 这里的配置必须与 ESLint 中的 prettier 配置一致，否则会出现冲突

### 3. VS Code 项目设置 (.vscode/settings.json)

```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "always"
  },
  "editor.formatOnSave": false,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "eslint.validate": ["javascript", "javascriptreact", "vue"],
  "eslint.format.enable": true
}
```

**关键配置说明：**

- `"editor.formatOnSave": false` - 关闭 VS Code 默认格式化
- `"source.fixAll.eslint": "always"` - 保存时自动应用 ESLint 修复
- `"eslint.validate"` - 指定哪些文件类型启用 ESLint 检查
- `"eslint.format.enable": true` - 启用 ESLint 的格式化功能

这种配置方式的核心思想是：让 ESLint 负责代码检查和格式化，ESLint 内部再调用 Prettier 进行格式处理。

## 四、Git 提交自动化（Husky + lint-staged）

### 1. 初始化 Git 仓库

```bash
git init
```

### 2. 安装并配置 Husky

```bash
pnpm dlx husky-init && pnpm install
# 或者在PowerShell中分开执行
pnpm dlx husky-init
pnpm install
```

Husky 可拦截 Git 钩子，在代码提交前自动执行指定命令，确保代码质量。

### 3. 问题与解决方案

**初始问题：**
默认配置的 `.husky/pre-commit` 文件内容为：

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pnpm lint
```

这会导致每次提交时进行全量代码检查，存在两个问题：

- 检查耗时长（项目越大越明显）
- 历史代码可能存在不符合规范的情况

### 4. 安装 lint-staged 解决问题

```bash
pnpm add -D lint-staged
```

lint-staged 只对 Git 暂存区（即将提交）的文件执行检查，避免全量检查，提高效率。

### 5. 在 package.json 中添加配置 lint-staged

```json
{
  "scripts": {
    "lint-staged": "lint-staged"
  },
  "lint-staged": {
    "*.{js,ts,vue}": [
      "eslint --fix"
    ]
  }
}
```

配置说明：

- 添加 `lint-staged` 运行脚本
- 设置只对暂存区的 js、ts、vue 文件执行 eslint 自动修复

### 6. 修改 pre-commit 钩子文件 (.husky/pre-commit)

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

pnpm lint-staged
```

现在，Git 提交前会通过 lint-staged 只检查和修复暂存区的代码，既保证了提交代码质量，又提高了效率。

## 五、工作流程与原理解析

### 开发过程中的代码格式化

1. 开发者编辑代码（可能不符合规范）
2. 按下 Ctrl+S 保存文件
3. VS Code 触发 ESLint 自动修复事件
4. ESLint 根据配置的规则检查代码
5. 发现格式问题后，调用 Prettier 进行格式化
6. 自动修复的代码呈现在编辑器中

### Git 提交时的自动检查

1. 开发者执行`git add`添加修改文件
2. 执行`git commit`提交代码
3. Husky 拦截 commit 操作，触发 pre-commit 钩子
4. 执行`pnpm lint-staged`命令
5. lint-staged 找出暂存区的文件并执行 eslint 修复
6. 如果有错误无法自动修复，提交会被阻止
7. 如果全部通过或已修复，完成提交

## 六、常见问题与解决方案

### 1. ESLint 修复不生效

- **检查 VS Code 设置** - 确保`"source.fixAll.eslint": "always"`
- **重启 ESLint 服务** - 命令面板执行`ESLint: Restart ESLint Server`
- **重启 VS Code** - 某些设置需要重启编辑器才能生效

### 2. Prettier 规则与 ESLint 冲突

- 确保`.prettierrc.json`与 eslint 配置中的 prettier 规则一致
- 引入`eslint-plugin-prettier`解决集成问题

### 3. husky 钩子执行异常

- Windows 环境优先使用 Git Bash 执行 git 命令，更兼容 husky 脚本
- 检查`.husky/pre-commit`文件权限
- 确认`package.json`中的 husky 和 lint-staged 配置正确

## 七、总结

通过以上配置，我们实现了：

1. 开发过程中按 Ctrl+S 自动格式化代码
2. Git 提交前自动检查和修复代码规范
3. 统一的团队代码风格
4. 提前发现潜在问题，减少潜在 bug

良好的代码规范配置可以让团队成员更专注于业务逻辑开发，减少在代码风格上的不必要讨论，提高代码质量和开发效率。
